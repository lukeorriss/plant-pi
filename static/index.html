<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="./css/style.css">
    <link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="./js/fontawesome-free-6.1.1-web/css/all.css">

    <!-- Tabulator -->
    <script src="./js/tabulator-5.1.7/dist/js/tabulator.js"></script>
    <link rel="stylesheet" href="./js/tabulator-5.1.7/dist/css/tabulator_semanticui.css">

    <!-- Mustache JS -->
    <script src="./js/mustache.js-4.2.0/mustache.js"></script>

    <!-- Chart JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Karla:wght@300;400&family=Montserrat:wght@300&family=Mukta:wght@200;300;400;500;600;700;800&family=Ubuntu&display=swap" rel="stylesheet">
    <title>Plant Pi Server</title>
</head>
<body>
   
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="./img/favicon.ico" class="mr-4" style="width: 50px; height: auto;" alt="">
                Plant Pi
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <div class="nav" id="nav-tab" role="tablist">
                    <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true"><i class="fa-solid fa-house"></i>Home</button>
                    <button class="nav-link" id="nav-terminal-tab" data-bs-toggle="tab" data-bs-target="#nav-terminal" type="button" role="tab" aria-controls="nav-profile" aria-selected="false"><i class="fa-solid fa-terminal"></i>Terminal</button>
                    <button class="nav-link" id="nav-logs-tab" data-bs-toggle="tab" data-bs-target="#nav-logs" type="button" role="tab" aria-controls="nav-contact" aria-selected="false"><i class="fa-solid fa-folder"></i>Logs</button>
                    <button class="nav-link" id="nav-settings-tab" data-bs-toggle="tab" data-bs-target="#nav-settings" type="button" role="tab" aria-controls="nav-contact" aria-selected="false"><i class="fa-solid fa-gears"></i>Settings</button>
                </div>   
            </div>
        </div>
        </nav>
 
    
    <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
            <div class="header"><p><i class="fa-solid fa-house"></i>Home</p></div>
            <div class="main-content">
                <form action="" id="button_control">
                    <button type="submit" class="btn btn-primary">Force Update</button>
                    <button id="l30m" type="button" class="btn btn-secondary">Last 30 Minutes</button>
                    <button id="lday" type="button" class="btn btn-secondary">Last Day</button>
                    <button id="lweek" type="button" class="btn btn-secondary">Last Week</button>
                    <button id="lmonth" type="button" class="btn btn-secondary">Last Month</button>
                    <button id="alltime" type="button" class="btn btn-secondary">All Time</button>
                </form>
                <div class="chart-containers mt-3">
                    <div class="chart-container">
                        <placeholder>Current Temperature (Â°F)</placeholder>
                        <!-- <canvas></canvas> -->
                    </div>
                    <div class="chart-container">
                        <placeholder>Current Humidity (%)</placeholder>
                        <!-- <canvas></canvas> -->
                    </div>
                    <div class="chart-container">
                        <placeholder>Current Moisture Level</placeholder>
                        <!-- <canvas></canvas> -->
                    </div>
                    <div class="chart-container">
                        <placeholder>Average Temperature: <span id="avg_temp"></span></placeholder>
                        <!-- <canvas></canvas> -->
                    </div>
                    <div class="chart-container">
                        <placeholder>Average Humidity: <span id="avg_hum"></span></placeholder>
                        <!-- <canvas></canvas> -->
                    </div>
                    <div class="chart-container">
                        <placeholder>Average Watering Interval: <span id="avg_water"></span></placeholder>
                        <!-- <canvas></canvas> -->
                    </div>
                </div>
            </div>
        </div>





        <div class="tab-pane fade" id="nav-terminal" role="tabpanel" aria-labelledby="nav-terminal-tab">
            <div class="header"><p><i class="fa-solid fa-terminal"></i>Terminal</p></div>

        </div>





        <div class="tab-pane fade" id="nav-logs" role="tabpanel" aria-labelledby="nav-logs-tab">
            <div class="header"><p><i class="fa-solid fa-folder"></i>Logs</p></div>
            <div class="main-content">
                <div id="button_control">
                    <button class="btn btn-secondary">API Logs</button>
                    <button class="btn btn-secondary">Plant Pi Logs</button>
                    <button class="btn btn-secondary">Error Logs</button>
                </div>
            </div>


        </div>






        <div class="tab-pane fade" id="nav-settings" role="tabpanel" aria-labelledby="nav-settings-tab">
            <div class="header"><p><i class="fa-solid fa-gears"></i>Settings</p></div>
            <div class="main-content mc-flex">
                <div class="options">
                                      
                    <button id="checksystem" class="btn btn-success m-1">Perform System Checks</button>
                    <button id="checkserver" class="btn btn-success m-1">Check Server Access</button>
                    <button id="testservices" class="btn btn-secondary m-1">Test Services</button>
                    <button id="testsensors" class="btn btn-secondary m-1">Test Sensors</button>
                    <button id="restartserver" class="btn btn-warning m-1">Restart Server</button>
                    <button id="restartplantpi" class="btn btn-warning m-1">Restart Plant Pi</button>
                    <button id="shutdownserver" class="btn btn-danger m-1">Shutdown Server</button>
                    <button id="shutdownplantpi" class="btn btn-danger m-1">Shutdown Plant Pi</button>

                    <div class="toggle-container">
                        <p>Log API</p>
                        <label class="switch">
                            <input type="checkbox" id="api_log_toggle">
                            <span></span>
                        </label> 
                    </div> 
                    <div class="toggle-container">
                        <p>Log Plant Pi</p>
                        <label class="switch">
                            <input type="checkbox" id="plantpi_log_toggle">
                            <span></span>
                        </label> 
                    </div> 
                    <div class="toggle-container">
                        <p>Log Errors</p>
                        <label class="switch">
                            <input type="checkbox" id="error_log_toggle">
                            <span></span>
                        </label> 
                    </div> 
                </div>
                <div class="output">
                    <pre id="options-output"></pre>
                </div>
            </div>
        </div>
    </div>
   
    
    <script>    

    // Home
        $('#button_control').on("submit", function(e){
            e.preventDefault();
            
        })

        function worker() {
            $.ajax({
                type: 'POST',
                url: '/api/plantpi/get_update',
                contentType: 'application/json;charset=UTF-8',
                data: '',
                dataType: 'json',
            })
            .done(function(pdata) {
                var ldata = pdata.data;
                console.log(ldata)
                console.log(JSON.parse(ldata.data))

            })
            .fail(function(jqXHR, textStatus, errorThrown) {
                alert(errorThrown)
            })
            // setTimeout(worker, 5000);
            
        };
        worker()

        $('#checksystem').click(function(){$('#options-output').text("Performing System Checks...")})
        $('#checkserver').click(function(){$('#options-output').text("Performing Server Checks...")})
        $('#testservices').click(function(){$('#options-output').text("Performing Service Tests...")})
        $('#testsensors').click(function(){$('#options-output').text("Performing Sensor Tests...")})
        $('#restartserver').click(function(){$('#options-output').text("Restarting Server...")})
        $('#restartplantpi').click(function(){$('#options-output').text("Restarting Plant Pi...")})
        $('#shutdownserver').click(function(){$('#options-output').text("Shutting Down Server...")})
        $('#shutdownplantpi').click(function(){$('#options-output').text("Shutting Down Plant Pi...")})
    
        $('#l30m').click(function(e){
            e.preventDefault();
            $('#avg_temp').text("Last 30 Minutes")
            $('#avg_hum').text("Last 30 Minutes")
            $('#avg_water').text("Last 30 Minutes")
        })
        $('#lday').click(function(e){
            e.preventDefault();
            $('#avg_temp').text("Last 24 Hours")
            $('#avg_hum').text("Last 24 Hours")
            $('#avg_water').text("Last 24 Hours")
        })
        $('#lweek').click(function(e){
            e.preventDefault();
            $('#avg_temp').text("Last Week")
            $('#avg_hum').text("Last Week")
            $('#avg_water').text("Last Week")
        })
        $('#lmonth').click(function(e){
            e.preventDefault();
            $('#avg_temp').text("Last Month")
            $('#avg_hum').text("Last Month")
            $('#avg_water').text("Last Month")
        })
        $('#alltime').click(function(e){
            e.preventDefault();
            $('#avg_temp').text("All Time")
            $('#avg_hum').text("All Time")
            $('#avg_water').text("All Time")
        })

        function changeAPISettings(ldata) {
            $.ajax({
                type: 'POST',
                url: '/api/plantpi/toggle_api',
                data: JSON.stringify(ldata),
                dataType: 'json',
            })
            .done(function(pdata){
                return pdata
            })
            .fail(function(jqXHR, textStatus, errorThrown){

            })
        }
    
        $('#api_log_toggle').change(function(){
            if (this.checked) {
                state = true;
            } else {
                state = false;
            }
            var ldata = {"log_api":state}
            changeAPISettings(ldata)
        })
        $('#plantpi_log_toggle').change(function(){
            if (this.checked) {
                state = true;
            } else {
                state = false;
            }
            var ldata = {"log_stats":state}
            changeAPISettings(ldata)
        })
        $('#error_log_toggle').change(function(){
            if (this.checked) {
                state = true;
            } else {
                state = false;
            }
            var ldata = {"log_errors":state}
            changeAPISettings(ldata)
        })
    
    </script>
</body>
</html>
